## Bảng `documents`

```sql
-- DDL (Data Definition Language) cho bảng documents
CREATE TABLE documents (
    id UUID PRIMARY KEY DEFAULT gen_random_uuid(),
    user_id UUID NOT NULL REFERENCES users(id) ON DELETE CASCADE,
    filename VARCHAR(255) NOT NULL,
    original_filename VARCHAR(255) NOT NULL,
    document_type VARCHAR(100),
    mime_type VARCHAR(100) NOT NULL,
    file_path VARCHAR(512) NOT NULL,
    file_size BIGINT,
    page_count INTEGER,
    status VARCHAR(50) DEFAULT 'uploaded',
    created_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT CURRENT_TIMESTAMP,
    processed_at TIMESTAMP WITH TIME ZONE,
    summary TEXT,
    importance_score DECIMAL(3,2),
    metadata JSONB,
    tags TEXT[],
    is_deleted BOOLEAN DEFAULT FALSE,
    is_public BOOLEAN DEFAULT FALSE,
    version INTEGER DEFAULT 1,
    parent_id UUID REFERENCES documents(id) ON DELETE SET NULL,
    project_id UUID REFERENCES projects(id) ON DELETE SET NULL,
    
    CONSTRAINT valid_status CHECK (status IN ('uploaded', 'processing', 'processed', 'failed', 'archived'))
);

-- Indexes để tối ưu truy vấn
CREATE INDEX idx_documents_user_id ON documents(user_id);
CREATE INDEX idx_documents_status ON documents(status);
CREATE INDEX idx_documents_created_at ON documents(created_at);
CREATE INDEX idx_documents_document_type ON documents(document_type);
CREATE INDEX idx_documents_tags ON documents USING GIN(tags);
CREATE INDEX idx_documents_metadata ON documents USING GIN(metadata jsonb_path_ops);
CREATE INDEX idx_documents_project_id ON documents(project_id) WHERE project_id IS NOT NULL;
```

### Ví Dụ Dữ Liệu trong Bảng `documents`

```sql
-- INSERT dữ liệu mẫu vào bảng documents
INSERT INTO documents (
    id, user_id, filename, original_filename, document_type, mime_type, 
    file_path, file_size, page_count, status, created_at, processed_at, 
    summary, importance_score, metadata, tags, is_public, version
) VALUES (
    '7ae92f3b-9c56-4e7a-8138-972bfd87f9a2',
    '45d9f08c-a37e-4b9c-8c55-89e7f8ea4273',
    '7ae92f3b-9c56-4e7a-8138-972bfd87f9a2.pdf',
    'FinTech_Payment_Gateway_Architecture.pdf',
    'technical_specification',
    'application/pdf',
    's3://documentai-bucket/raw-documents/45d9f08c-a37e-4b9c-8c55-89e7f8ea4273/7ae92f3b-9c56-4e7a-8138-972bfd87f9a2.pdf',
    2458631,
    42,
    'processed',
    '2024-01-15 09:32:47+00',
    '2024-01-15 09:35:12+00',
    'This document describes the architecture of the FinTech Payment Gateway system. It details a microservice-based approach with an API Gateway frontend, multiple business logic services, and a multi-layer database strategy. The document includes security considerations, high availability design, and scaling strategies. Key components include authentication, transaction processing, reporting, and monitoring subsystems.',
    0.87,
    '{
        "author": "Jane Smith",
        "department": "Engineering",
        "version_history": [
            {"version": 1, "date": "2024-01-10", "author": "Jane Smith", "notes": "Initial draft"},
            {"version": 2, "date": "2024-01-15", "author": "Jane Smith", "notes": "Final version"}
        ],
        "related_documents": ["req-spec-123", "security-spec-456"],
        "approvers": ["john.doe@company.com", "alice.wong@company.com"],
        "approval_status": "approved",
        "system_components": ["API Gateway", "Auth Service", "Transaction Service", "Reporting Service", "Database Layer"],
        "technology_stack": ["Java", "Spring Boot", "PostgreSQL", "Redis", "Kafka", "Docker", "Kubernetes"]
    }',
    ARRAY['architecture', 'microservices', 'database', 'security', 'payment', 'fintech'],
    false,
    2
);

INSERT INTO documents (
    id, user_id, filename, original_filename, document_type, mime_type, 
    file_path, file_size, page_count, status, created_at, 
    summary, metadata, tags
) VALUES (
    'c5e89d22-7a1d-4bf3-9c38-517b45e1d8b6',
    '45d9f08c-a37e-4b9c-8c55-89e7f8ea4273',
    'c5e89d22-7a1d-4bf3-9c38-517b45e1d8b6.docx',
    'User_Requirements_Specification.docx',
    'requirements',
    'application/vnd.openxmlformats-officedocument.wordprocessingml.document',
    's3://documentai-bucket/raw-documents/45d9f08c-a37e-4b9c-8c55-89e7f8ea4273/c5e89d22-7a1d-4bf3-9c38-517b45e1d8b6.docx',
    1245782,
    28,
    'processing',
    '2024-03-02 14:27:31+00',
    null,
    '{
        "author": "Robert Johnson",
        "department": "Product Management",
        "priority": "high",
        "stakeholders": ["Finance", "Customer Support", "Compliance"],
        "project_phase": "planning",
        "estimated_completion": "2024-06-30"
    }',
    ARRAY['requirements', 'user-stories', 'functional', 'non-functional']
);
```